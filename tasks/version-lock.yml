---
- name: "Ensure yum-plugin-versionlock is instaled"
  ansible.builtin.yum:
    name: "yum-plugin-versionlock"
    state: present
  when: ansible_os_family == "RedHat"

- name: "Version lock mdatp package (Debian Family)"
  ansible.builtin.dpkg_selections:
    name: "mdatp"
    selection: hold
  when:
    - ansible_os_family == "RedHat"
    - mdatp_apt_package_version is defined
    - mdatp_apt_package_version | length > 0

- name: "Version lock mdatp package (RedHat Family): {{ mdatp_yum_package_version }}"
  community.general.yum_versionlock:
    name: "{{ mdatp_yum_package_version }}"
    state: present
  when:
    - ansible_os_family == "RedHat"
    - mdatp_yum_package_version is defined
    - mdatp_yum_package_version is not none
    - mdatp_yum_package_version | length > 0

- name: "Remove version lock on mdatp package (Debian Family)"
  ansible.builtin.dpkg_selections:
    name: "mdatp"
    selection: install
  when: ansible_os_family == "Debian" and mdatp_apt_package_version_hold | default('') == ''

- name: "Remove version lock on mdatp package (RedHat Family)"
  community.general.yum_versionlock:
    name: "mdatp"
    state: absent
  when: ansible_os_family == "RedHat" and mdatp_yum_package_version | default('') == ''
